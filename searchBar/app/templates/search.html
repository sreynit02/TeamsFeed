{%extends 'base.html' %}
{% block main %}
        <p>Total cost: {{value}}</p>
        <p>Results: {{searchResults}}</p>
<!-- import googlechart api -->
<script src="https://www.gstatic.com/charts/loader.js"></script>
<!-- create a div for piechart -->
    <div id="piechart" style="width: 900px; height: 500px;"></div>
<!-- create table for search result -->
    </div>
        <table class="table table-hover">
            <thead>
              <tr>
                {%for header in tableHeader%}

                <th scope="col">{{header}}</th>
            
                {%endfor %}
              </tr>
            </thead>
            <tbody>
              {% if option == "1" or option == "4" or option == "7" %}
                {% for searchResult in searchResults %}
                <tr>
                  <td>{{searchResult.invoiceNo}}</td>
                  <td>{{searchResult.dateReceived}}</td>
                  <td>{{searchResult.datePaid}}</td>
                  <td>{{searchResult.totalPound}}</td>
                  <td>{{searchResult.totalCost}}</td>
                </tr>
              {% endfor %}
              {% elif option == "5" %}
              {% for searchResult in searchResults %}
              <tr>
                  <td>{{searchResult.firstName}}</td>
                  <td>{{searchResult.lastName}}</td>
                  <td>{{searchResult.phoneNumber}}</td>
                  <td>{{searchResult.city}}</td>
                  <td>{{searchResult.county}}</td>
                  <td>{{searchResult.state}}</td>
              </tr>
              {% endfor %}
              {% endif%}
            </tbody>
        </table>
        <script type="text/javascript">
          //loading packages
          google.charts.load('current', {'packages':['corechart']});
          google.charts.setOnLoadCallback(drawChart);
          //create function to draw chart with data
          function drawChart() {
          //use jinja to get searchlist that was passed from app.py and keep the list's datatype consistent using safe filter
            let results={{ countyList | safe }} 
          //create an empty list
            resultsList=[]
          //create a new data table with the google chart api
            var data = new google.visualization.DataTable();
          //add new columns to data table
            data.addColumn('string', 'County');
            data.addColumn('number', 'Number of farmers in county');
          //loop through each item in result table 
            for (let i=0;i<results.length;i++){
              tempArray=[]
          //append each item to an array and add a new row to the data table 
              tempArray.push(results[i][0])
              tempArray.push(results[i][1])
              data.addRow(Array.from(tempArray))
            }
          //add title to pie chart
            var options = {
              title: 'Number of Farmers from each county'
            };
          //displays piechart created in the google api in the div with the id = piechart
            var chart = new google.visualization.PieChart(document.getElementById('piechart'));
            chart.draw(data, options);
          }
        </script>
{%endblock%}